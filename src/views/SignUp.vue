<template>
  <v-container>
    <!--    {{groups}}}-->
    <v-row class="text-center">
      <v-col cols="12">
        <!--        <v-img src="https://www.carlogos.org/logo/Volkswagen-logo-2015-1920x1080.png"></v-img>-->
        <v-card class="mx-auto" max-width="364">
          <v-card-text>
            <div class="d-inline-flex justify-center">
              <v-img height="50" src="@/../public/11.png" width="50"/>
            </div>
            <div class="headline text--primary">Регистрация поставщика</div>
            <p class="mb-1">Введите данные вашей компании, чтобы получить доступ к заказам.</p>
            <!--            ref="form" v-model="valid"-->
            <v-form ref="form" v-model="valid">
              <v-row>
                <!--                FIO-->
                <v-col class="pb-0 pt-1" cols="12" md="12">
                  <!--                  :rules="rules.fullName"-->
                  <v-text-field
                      v-model="fullName"

                      :rules="rules.fullName"
                      label="Введите ваше ФИО"
                      outlined
                      required
                  ></v-text-field>
                </v-col>
                <v-col class="pb-0 pt-1" cols="12" md="12">
                  <!--                  :rules="rules.fullName"-->
                  <v-text-field
                      v-model="phoneNumber"
                      disabled
                      label="Ваш номер телефона"
                      outlined
                  ></v-text-field>
                </v-col>
                <!--                Comppany-->
                <v-col class="pb-0 pt-1" cols="12" md="12">
                  <!--                  :rules="rules.companyName"-->
                  <v-text-field
                      v-model="companyName"

                      :rules="rules.companyName"
                      label="Введите Название компании"
                      outlined
                      required
                  ></v-text-field>
                </v-col>
                <!--                City-->
                <v-col class="pb-0 pt-1" cols="12" md="12">
                  <!--                  :rules="rules.cityName"-->
                  <v-text-field
                      v-model="cityName"

                      :rules="rules.cityName"
                      label="Введите Город"
                      outlined
                      required
                  ></v-text-field>
                </v-col>
                <!--                Adress-->
                <v-col class="pb-0 pt-1" cols="12" md="12">
                  <!--                  :rules="rules.address"-->
                  <v-text-field
                      v-model="address"

                      :rules="rules.address"
                      label="Введите Адрес склада"
                      outlined
                      required
                  ></v-text-field>
                </v-col>
                <v-col class="pb-0 pt-1" cols="12" md="12">
                  <Field ref="status" :field="status" :multiple="false" label="Ваша должность"></Field>
                </v-col>
                <v-col class="pb-0 pt-1" cols="12" md="12">
                  <Field ref="carMaker" :field="carMaker" :iconInItem="true" label="Выберите марки"></Field>
                </v-col>
                <v-col class="pb-0 pt-1 px-6" cols="12" md="12">
                  <v-textarea v-model="about" :rules="rules.about" auto-grow label="Откуда о нас узнали" no-resize row-height="24px" rows="1"></v-textarea>
                </v-col>
                <v-col cols="12">
                  <v-layout v-if="this.$route.meta === 'registration'" align-center class="pb-2" justify-center>
                    <v-checkbox v-model="checkbox" class="mt-0 pt-0" hide-details></v-checkbox>
                    <a href="https://telegra.ph/Soglasie-na-obrabotku-dannyh-08-09" target="_blank">Даю согласие на обработку данных</a>
                  </v-layout>
                  <v-btn :disabled="!valid || !checkbox" class="mt-1" color="primary" @click="submit">Сохранить</v-btn>
                </v-col>
              </v-row>
            </v-form>
          </v-card-text>
        </v-card>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
import Field from "../components/Field"

export default {
  name: 'SignUp',
  components: {
    'Field': Field
    // 'Field': () => import('@/components/Field.vue')
  },
  async mounted() {
    try {
      await Promise.all([this.$API.car.maker(), this.$API.car.phone(this.$route.params.id),this.$API.status.directorStatus()]).then(values => {
        this.carMaker.items = values[0].data.slice()
        this.phoneNumber = values[1].data.phone
        this.status.items = values[2].data
      })
    } catch (e) {
      console.error(e, 'error')
    }
    this.carMakerLength = this.carMaker.items.length
  },
  data: () => ({
    valid: true,
    rules: {
      fullName: [v => !!v || 'Не может быть пустым',],
      companyName: [v => !!v || 'Не может быть пустым',],
      cityName: [v => !!v || 'Не может быть пустым',],
      address: [v => !!v || 'Не может быть пустым'],
      about: [v => !!v || 'Не может быть пустым',]
    },
    fullName: '',
    companyName: '',
    phoneNumber: '',
    cityName: '',
    address: '',
    carMaker: { items: [], value: [] },
    carMakerLength: 0,
    status: { items: [{ id: 1, name: 'Генеральный директор/собственник' }, { id: 2, name: 'Менеджер по продажам' }], value: [], },
    about: '',
    checkbox: false,
    dialog: false,
  }),
  methods: {
    async submit() {
      if (this.$refs.form.validate()) {
        const payload = {
          full_name: this.fullName,
          company_name: this.companyName,
          city_name: this.cityName,
          address: this.address,
          user_id: this.$route.params.id,
          state_auto: { buAuto: this.buAuto, newAuto: this.newAuto },
          phone_number: this.phone_number,
          about: this.about,
          status: this.status,
        }
        try {
          await this.$API.car.addUser(payload)
          alert('Регистрация прошла успешно')
          this.resetForm()
        } catch (e) {
          alert('Произошла ошибка')
          console.error(e, 'error')
        }
      }
    },
    resetForm() {
      this.$refs.form.reset()
    },
  },
  computed: {},
}
</script>

